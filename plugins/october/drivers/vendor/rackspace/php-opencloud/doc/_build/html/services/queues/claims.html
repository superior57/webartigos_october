

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Claims &mdash; php-opencloud 1.12.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="php-opencloud 1.12.1 documentation" href="../../index.html"/>
        <link rel="up" title="Queues v1" href="index.html"/>
        <link rel="next" title="Volumes v1" href="../volume/index.html"/>
        <link rel="prev" title="Messages" href="messages.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> php-opencloud</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../autoscale/index.html">Auto Scale v2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../autoscale/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../autoscale/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../autoscale/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../autoscale/index.html#further-links">Further Links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../compute/index.html">Compute v2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../compute/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compute/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compute/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compute/index.html#further-links">Further Links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../database/index.html">Databases v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database/index.html#further-links">Further Links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dns/index.html">DNS v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dns/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dns/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dns/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dns/index.html#further-links">Further Links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../identity/index.html">Identity v2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../identity/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../identity/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../identity/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../identity/index.html#further-links">Further Links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../image/index.html">Images v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../image/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../image/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../image/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../image/index.html#further-links">Further Links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../load-balancer/index.html">Load Balancer v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../load-balancer/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../load-balancer/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../load-balancer/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../load-balancer/index.html#further-links">Further Links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring/index.html">Monitoring v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.html#further-links">Further links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Networking v2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html#further-links">Further links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../object-store/index.html">Object Store v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../object-store/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../object-store/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../object-store/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../object-store/index.html#further-links">Further links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../orchestration/index.html">Orchestration v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../orchestration/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../orchestration/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../orchestration/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../orchestration/index.html#further-links">Further links</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Queues v1</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#setup">Setup</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#further-links">Further links</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../volume/index.html">Volumes v1</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../volume/index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../volume/index.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../volume/index.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../volume/index.html#further-links">Further links</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../debugging.html">Debugging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../debugging.html#strategy-1-meaningful-exception-handling">Strategy 1: Meaningful exception handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debugging.html#strategy-2-wire-logging">Strategy 2: Wire logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../caching-creds.html">Caching credentials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../caching-creds.html#filesystem-example">Filesystem example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../iterators.html">Iterators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../iterators.html#common-behaviour">Common behaviour</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iterators.html#very-important-note">Very important note</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iterators.html#using-paginated-collections">Using paginated collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iterators.html#setting-up-a-paginatediterator">Setting up a PaginatedIterator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../regions.html">Rackspace regions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../url-types.html">URL types</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../url-types.html#internalurl">internalURL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../url-types.html#publicurl">publicURL</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../logging.html">Logging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../logging.html#logger-injection">Logger injection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../http-clients.html">HTTP Clients</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../http-clients.html#default-http-headers">Default HTTP headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../http-clients.html#user-agents">User agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../http-clients.html#other-functionality">Other functionality</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../auth.html">Authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../auth.html#service-catalog">Service Catalog</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">php-opencloud</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Queues v1</a> &raquo;</li>
      
    <li>Claims</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../_sources/services/queues/claims.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="claims">
<h1>Claims<a class="headerlink" href="#claims" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>In order to work with messages, you must first retrieve a queue by its name:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$queue</span> <span class="o">=</span> <span class="nv">$service</span><span class="o">-&gt;</span><span class="na">getQueue</span><span class="p">(</span><span class="s1">&#39;{queueName}&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="claim-messages">
<h2>Claim messages<a class="headerlink" href="#claim-messages" title="Permalink to this headline">¶</a></h2>
<p>This operation claims a set of messages (up to the value of the limit
parameter) from oldest to newest and skips any messages that are already
claimed. If no unclaimed messages are available, the API returns a
<tt class="docutils literal"><span class="pre">204</span> <span class="pre">No</span> <span class="pre">Content</span></tt> message.</p>
<p>When a client (worker) finishes processing a message, it should delete
the message before the claim expires to ensure that the message is
processed only once. As part of the delete operation, workers should
specify the claim ID (which is best done by simply using the provided
href). If workers perform these actions, then if a claim simply expires,
the server can return an error and notify the worker of the race
condition. This action gives the worker a chance to roll back its own
processing of the given message because another worker can claim the
message and process it.</p>
<p>The age given for a claim is relative to the server&#8217;s clock. The claim&#8217;s
age is useful for determining how quickly messages are getting processed
and whether a given message&#8217;s claim is about to expire.</p>
<p>When a claim expires, it is released. If the original worker failed to
process the message, another client worker can then claim the message.</p>
<div class="section" id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">ttl</span></tt> attribute specifies how long the server waits before
releasing the claim. The ttl value must be between 60 and 43200 seconds
(12 hours). You must include a value for this attribute in your request.</p>
<p>The <tt class="docutils literal"><span class="pre">grace</span></tt> attribute specifies the message grace period in seconds.
The value of grace value must be between 60 and 43200 seconds (12
hours). You must include a value for this attribute in your request. To
deal with workers that have stopped responding (for up to 1209600
seconds or 14 days, including claim lifetime), the server extends the
lifetime of claimed messages to be at least as long as the lifetime of
the claim itself, plus the specified grace period. If a claimed message
would normally live longer than the grace period, its expiration is not
adjusted.</p>
<p>The <tt class="docutils literal"><span class="pre">limit</span></tt> attribute specifies the number of messages to return, up
to 20 messages. If limit is not specified, limit defaults to 10. The
limit parameter is optional.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">OpenCloud\Common\Constants\Datetime</span><span class="p">;</span>

<span class="nv">$queue</span><span class="o">-&gt;</span><span class="na">claimMessages</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;limit&#39;</span> <span class="o">=&gt;</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s1">&#39;grace&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="nx">Datetime</span><span class="o">::</span><span class="na">MINUTE</span><span class="p">,</span>
    <span class="s1">&#39;ttl&#39;</span>   <span class="o">=&gt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="nx">Datetime</span><span class="o">::</span><span class="na">MINUTE</span>
<span class="p">));</span>
</pre></div>
</div>
<p><a class="reference external" href="https://raw.githubusercontent.com/rackspace/php-opencloud/master/samples/Queues/claim-messages.php">Get the executable PHP script for this example</a></p>
</div>
</div>
<div class="section" id="query-claim">
<h2>Query claim<a class="headerlink" href="#query-claim" title="Permalink to this headline">¶</a></h2>
<p>This operation queries the specified claim for the specified queue. Claims with
malformed IDs or claims that are not found by ID are ignored.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$claim</span> <span class="o">=</span> <span class="nv">$queue</span><span class="o">-&gt;</span><span class="na">getClaim</span><span class="p">(</span><span class="s1">&#39;{claimId}&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="update-claim">
<h2>Update claim<a class="headerlink" href="#update-claim" title="Permalink to this headline">¶</a></h2>
<p>This operation updates the specified claim for the specified queue.
Claims with malformed IDs or claims that are not found by ID are
ignored.</p>
<p>Clients should periodically renew claims during long-running batches of
work to avoid losing a claim while processing a message. The client can
renew a claim by executing this method on a specific <strong>Claim</strong> and
including a new TTL. The API will then reset the age of the claim and
apply the new TTL.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">use</span> <span class="nx">OpenCloud\Common\Constants\Datetime</span><span class="p">;</span>

<span class="nv">$claim</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;ttl&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span> <span class="o">*</span> <span class="nx">Datetime</span><span class="o">::</span><span class="na">MINUTE</span>
<span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="release-claim">
<h2>Release claim<a class="headerlink" href="#release-claim" title="Permalink to this headline">¶</a></h2>
<p>This operation immediately releases a claim, making any remaining
undeleted messages that are associated with the claim available to other
workers. Claims with malformed IDs or claims that are not found by ID
are ignored.</p>
<p>This operation is useful when a worker is performing a graceful
shutdown, fails to process one or more messages, or is taking longer
than expected to process messages, and wants to make the remainder of
the messages available to other workers.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="nv">$message</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../volume/index.html" class="btn btn-neutral float-right" title="Volumes v1"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="messages.html" class="btn btn-neutral" title="Messages"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Jamie Hannaford, Shaunak Kashyap.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.12.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>